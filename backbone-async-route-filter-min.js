(function(e,t){var n=e.Router.extend;e.Router.extend=function(){var e=n.apply(this,arguments),r=e.prototype,i=this.prototype;t.each(["before","after"],function(e){t.defaults(r[e],i[e])});return e};t.extend(e.Router.prototype,{route:function(n,r,i){if(!t.isRegExp(n))n=this._routeToRegExp(n);if(t.isFunction(r)){i=r;r=""}if(!i)i=this[r];var s=this;var o=[];var u=[];t.each(s.before,function(e,t){o.push({filter:t,filterFn:e})});t.each(s.after,function(e,t){u.push({filter:t,filterFn:e})});e.history.route(n,function(a){function h(e,n){var r=e.shift();if(r){var o=t.isRegExp(r.filter)?r.filter:s._routeToRegExp(r.filter);if(o.test(a)){var u=t.isFunction(r.filterFn)?r.filterFn:s[r.filterFn];u.apply(s,[a,f,function(){h(e,n)}])}else{h(e,n)}}else if(n){i.apply(s,f)}}var f=s._extractParameters(n,a);var l=t.clone(o);var c=t.clone(u);h(l,true);s.trigger.apply(s,["route:"+r].concat(f));s.trigger("route",r,f);e.history.trigger("route",s,r,f);h(c)});return this}})})(Backbone,_)